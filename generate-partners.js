/**
 * PARTNERS DATA GENERATOR
 * =======================
 * Run this script to auto-generate partners.js from your images folder
 * 
 * Usage: node generate-partners.js
 */

const fs = require('fs');
const path = require('path');

const PARTNERS_DIR = './static/images/partners';
const OUTPUT_FILE = './static/js/partners.js';

/**
 * Load custom titles from titles.txt if it exists
 */
function loadCustomTitles() {
    const titlesFile = path.join(PARTNERS_DIR, 'titles.txt');
    const customTitles = {};
    
    if (fs.existsSync(titlesFile)) {
        console.log('ğŸ“ Found titles.txt - using custom titles\n');
        const content = fs.readFileSync(titlesFile, 'utf8');
        
        content.split('\n').forEach(line => {
            line = line.trim();
            if (line && !line.startsWith('#')) {
                const parts = line.split('|');
                if (parts.length === 2) {
                    const filename = parts[0].trim();
                    const title = parts[1].trim();
                    customTitles[filename] = title;
                }
            }
        });
        
        console.log(`âœ“ Loaded ${Object.keys(customTitles).length} custom titles\n`);
    }
    
    return customTitles;
}

/**
 * Scan all images in partners directory
 */
function scanPartners() {
    // Check if directory exists
    if (!fs.existsSync(PARTNERS_DIR)) {
        console.error(`âŒ Directory not found: ${PARTNERS_DIR}`);
        console.log('ğŸ’¡ Make sure you run this from the root of your project');
        process.exit(1);
    }
    
    // Load custom titles if available
    const customTitles = loadCustomTitles();
    
    const files = fs.readdirSync(PARTNERS_DIR);
    
    // Get all image files
    const images = files.filter(file => 
        /\.(jpg|jpeg|png|gif|webp)$/i.test(file) &&
        file !== 'titles.txt'
    ).sort(); // Sort alphabetically
    
    console.log(`ğŸ“ Found ${images.length} partner images\n`);
    
    // Generate partner objects with smart titles
    const partners = images.map(filename => {
        let title;
        
        // Use custom title if available
        if (customTitles[filename]) {
            title = customTitles[filename];
            console.log(`âœ“ ${filename} â†’ "${title}" (custom)`);
        } else {
            // Auto-generate title from filename
            title = filename
                .replace(/\.(jpg|jpeg|png|gif|webp)$/i, '') // Remove extension
                .replace(/image[_-]?\d+/i, '') // Remove "image_123" pattern
                .replace(/[_-]/g, ' ') // Replace underscores/hyphens with spaces
                .trim();
            
            // If empty after cleanup, use filename without extension
            if (!title) {
                title = filename.replace(/\.(jpg|jpeg|png|gif|webp)$/i, '');
            }
            
            // Capitalize first letter of each word
            title = title.split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                .join(' ');
            
            console.log(`âœ“ ${filename} â†’ "${title}" (auto)`);
        }
        
        return {
            filename: filename,
            title: title
        };
    });
    
    return partners;
}

/**
 * Generate the partners.js file
 */
function generateFile() {
    console.log('ğŸ”¨ Generating partners.js...\n');
    
    const partners = scanPartners();
    
    const fileContent = `/**
 * AUTO-GENERATED PARTNERS CONFIG
 * ==============================
 * âš ï¸  DO NOT EDIT THIS FILE MANUALLY
 * 
 * Generated: ${new Date().toISOString()}
 * Generator: generate-partners.js
 * 
 * To regenerate: Run 'node generate-partners.js'
 * 
 * WARNING: Manual edits will be overwritten!
 */

window.PARTNERS_DATA = {
    basePath: "/static/images/partners/",
    
    partners: ${JSON.stringify(partners, null, 8)}
};

/**
 * =============================================
 * HOW TO ADD NEW PARTNERS
 * =============================================
 * 
 * OPTION 1: Descriptive Filenames (Recommended)
 * ----------------------------------------------
 * Name your files descriptively:
 *   amaia-land.jpg â†’ "Amaia Land"
 *   crown-asia.png â†’ "Crown Asia"
 *   partner-name.jpeg â†’ "Partner Name"
 * 
 * OPTION 2: Custom Titles File
 * -----------------------------
 * Create: /static/images/partners/titles.txt
 * 
 * Format (one per line):
 * image_146.jpeg | Amaia Land
 * image_148.jpeg | Community Event
 * partner-logo.png | Partner Name
 * 
 * (Lines starting with # are ignored as comments)
 * 
 * Step 1: Add images to folder
 * -----------------------------
 * /static/images/partners/
 *   â”œâ”€â”€ image_146.jpeg
 *   â”œâ”€â”€ new_partner.jpg
 *   â”œâ”€â”€ another_partner.png
 *   â””â”€â”€ titles.txt  (optional)
 * 
 * Step 2: Run the generator
 * -------------------------
 * node generate-partners.js
 * 
 * Step 3: Upload & Done!
 * ----------------------
 * Git will commit the updated partners.js
 * 
 * =============================================
 */
`;
    
    // Ensure output directory exists
    const outputDir = path.dirname(OUTPUT_FILE);
    if (!fs.existsSync(outputDir)) {
        fs.mkdirSync(outputDir, { recursive: true });
    }
    
    fs.writeFileSync(OUTPUT_FILE, fileContent);
    
    console.log(`\nâœ… Generated ${OUTPUT_FILE}`);
    console.log(`ğŸ“¦ Total partners: ${partners.length}`);
    console.log(`\nğŸš€ Ready to commit and push!`);
}

// Run the generator
try {
    generateFile();
} catch (error) {
    console.error('âŒ Error:', error.message);
    process.exit(1);
}
